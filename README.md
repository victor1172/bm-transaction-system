# bm-transaction-systembunnyMax Homework 交易系統環境配置    Java SE 17    step1    run docker    https://github.com/victor1172/docker-imagestep2    CREATE EXTENSION IF NOT EXISTS "pgcrypto";    CREATE TABLE client_user (    user_uuid UUID DEFAULT gen_random_uuid() PRIMARY KEY,    user_name VARCHAR(100) NOT NULL,    user_email VARCHAR(255) UNIQUE NOT NULL,    user_password TEXT NOT NULL,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 用於 Hibernate 樂觀鎖    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        -- 添加註解    COMMENT ON TABLE client_user IS '使用者表，存儲使用者基本資訊';    COMMENT ON COLUMN client_user.user_uuid IS '使用者 PK';    COMMENT ON COLUMN client_user.user_name IS '使用者名稱';    COMMENT ON COLUMN client_user.user_email IS '使用者電子郵件 (唯一)';    COMMENT ON COLUMN client_user.user_password IS '使用者密碼 (加密後儲存)';    COMMENT ON COLUMN client_user.modify_dt IS '最後修改時間，提供 Hibernate 樂觀鎖機制';    COMMENT ON COLUMN client_user.created_at IS '使用者創建時間';        CREATE TABLE merchant (    merchant_uuid UUID DEFAULT gen_random_uuid() PRIMARY KEY,    merchant_name VARCHAR(255) NOT NULL,    merchant_email VARCHAR(255) UNIQUE NOT NULL,    merchant_password TEXT NOT NULL,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 用於 Hibernate 樂觀鎖    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        -- 添加註解    COMMENT ON TABLE merchant IS '商家表，存儲商家基本資訊';    COMMENT ON COLUMN merchant.merchant_uuid IS '商家 PK';    COMMENT ON COLUMN merchant.merchant_name IS '商家名稱';    COMMENT ON COLUMN merchant.merchant_email IS '商家電子郵件 (唯一)';    COMMENT ON COLUMN merchant.merchant_password IS '商家密碼 (加密後儲存)';    COMMENT ON COLUMN merchant.modify_dt IS '最後修改時間，提供 Hibernate 樂觀鎖機制';    COMMENT ON COLUMN merchant.created_at IS '商家創建時間';        CREATE TABLE prepaid_cash_account (    account_id SERIAL PRIMARY KEY,    owner_id UUID NOT NULL UNIQUE,    balance NUMERIC(15,2) DEFAULT 0 CHECK (balance >= 0),    account_type VARCHAR(10) CHECK (account_type IN ('USER', 'MERCHANT')) NOT NULL,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 用於 Hibernate 樂觀鎖    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        -- 添加註解    COMMENT ON TABLE prepaid_cash_account IS '預付現金帳戶表，儲存使用者的餘額資訊';    COMMENT ON COLUMN prepaid_cash_account.account_id IS '預付帳戶 PK';    COMMENT ON COLUMN prepaid_cash_account.owner_id IS '使用者或商家 UUID';    COMMENT ON COLUMN prepaid_cash_account.balance IS '帳戶餘額，僅允許非負值';    COMMENT ON COLUMN prepaid_cash_account.account_type IS '帳戶類型 (USER, MERCHANT)';    COMMENT ON COLUMN prepaid_cash_account.modify_dt IS '最後修改時間，提供 Hibernate 樂觀鎖機制';    COMMENT ON COLUMN prepaid_cash_account.created_at IS '帳戶創建時間';            CREATE TABLE account_balance_record (    record_id SERIAL PRIMARY KEY,    account_id INT NOT NULL,    owner_id UUID NOT NULL,    transaction_type VARCHAR(10) NOT NULL,    amount NUMERIC NOT NULL,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        -- 添加註解    COMMENT ON TABLE account_balance_record IS '預付現金帳戶金額異動表';    COMMENT ON COLUMN account_balance_record.record_id IS '金額異動表 PK';    COMMENT ON COLUMN account_balance_record.account_id IS '帳戶 ID';    COMMENT ON COLUMN account_balance_record.owner_id IS '擁有者 ID';    COMMENT ON COLUMN account_balance_record.transaction_type IS '交易類型: DEPOSIT or WITHDRAW';    COMMENT ON COLUMN account_balance_record.amount IS '金額 (DEPOSIT 為正數, WITHDRAW 為負數)';            CREATE TABLE product (    product_id SERIAL PRIMARY KEY,    product_name VARCHAR(255) NOT NULL,    product_desc TEXT,    merchant_uuid UUID,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 樂觀鎖機制    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        COMMENT ON TABLE product IS '產品基本資訊表';    COMMENT ON COLUMN product.product_id IS '產品 PK';    COMMENT ON COLUMN product.product_name IS '產品名稱';    COMMENT ON COLUMN product.product_desc IS '產品描述';    COMMENT ON COLUMN product.merchant_uuid IS '所屬商家的 UUID，對應商家';    COMMENT ON COLUMN product.modify_dt IS '最後修改時間，提供 Hibernate 樂觀鎖機制';    COMMENT ON COLUMN product.created_at IS '產品創建時間';            CREATE TABLE product_sku (    product_sku_id SERIAL PRIMARY KEY,    product_id INT NOT NULL,    product_sku_name VARCHAR(255) NOT NULL,    product_sku_price NUMERIC(15,2) CHECK (product_sku_price >= 0),    product_sku_cost NUMERIC(15,2) CHECK (product_sku_cost >= 0),    qty INTEGER NOT NULL DEFAULT 0,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 樂觀鎖機制    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        COMMENT ON TABLE product_sku IS '產品 SKU 表，每個產品可能有多個 SKU';    COMMENT ON COLUMN product_sku.product_sku_id IS '產品 SKU  PK';    COMMENT ON COLUMN product_sku.product_id IS '關聯的產品 ID';    COMMENT ON COLUMN product_sku.product_sku_name IS 'SKU 名稱 (例如不同規格、顏色)';    COMMENT ON COLUMN product_sku.product_sku_price IS 'SKU 售價';    COMMENT ON COLUMN product_sku.product_sku_cost IS 'SKU 成本價';    COMMENT ON COLUMN product_sku.qty IS 'SKU 數量';    COMMENT ON COLUMN product_sku.modify_dt IS '最後修改時間，提供 Hibernate 樂觀鎖機制';    COMMENT ON COLUMN product_sku.created_at IS 'SKU 創建時間';            CREATE TABLE orders (    order_uuid UUID DEFAULT gen_random_uuid() PRIMARY KEY,    client_user_uuid UUID NOT NULL,    merchant_uuid UUID NOT NULL,    product_id INT NOT NULL,    product_sku_id INT NOT NULL,    qty INT CHECK (qty > 0) NOT NULL,    unit_price NUMERIC(15,2) CHECK (unit_price >= 0) NOT NULL,    unit_cost NUMERIC(15,2) CHECK (unit_cost >= 0) NOT NULL,    total_price NUMERIC(15,2) CHECK (total_price >= 0) NOT NULL,    total_cost NUMERIC(15,2) CHECK (total_cost >= 0) NOT NULL,    order_status VARCHAR(50) CHECK (order_status IN ('Pending', 'Completed', 'Cancelled')) NOT NULL,    payment_complete_dt TIMESTAMP NULL,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 用於 Hibernate 樂觀鎖    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        -- 添加註解    COMMENT ON TABLE orders IS '訂單表，記錄使用者購買商品的交易資訊';    COMMENT ON COLUMN orders.order_uuid IS '訂單 PK';    COMMENT ON COLUMN orders.client_user_uuid IS '關聯的使用者 UUID';    COMMENT ON COLUMN orders.merchant_uuid IS '關聯的商家 UUID';    COMMENT ON COLUMN orders.product_id IS '關聯的產品 ID';    COMMENT ON COLUMN orders.product_sku_id IS '關聯的產品 SKU ID';    COMMENT ON COLUMN orders.qty IS '購買數量，必須大於 0';    COMMENT ON COLUMN orders.unit_price IS '單位售價 (產品 SKU 價格)';    COMMENT ON COLUMN orders.unit_cost IS '單位成本 (產品 SKU 成本)';    COMMENT ON COLUMN orders.total_price IS '訂單總價格 = unit_price * qty';    COMMENT ON COLUMN orders.total_cost IS '訂單總成本 = unit_cost * qty';    COMMENT ON COLUMN orders.order_status IS '訂單狀態 (Pending, Completed, Cancelled)';    COMMENT ON COLUMN orders.payment_complete_dt IS '付款完成時間 (當訂單完成時才填寫)';    COMMENT ON COLUMN orders.modify_dt IS '最後修改時間，提供 Hibernate 樂觀鎖機制';    COMMENT ON COLUMN orders.created_at IS '訂單創建時間';        CREATE TABLE order_modify (    order_modify_id SERIAL PRIMARY KEY,    order_uuid UUID NOT NULL,    client_user_uuid UUID NOT NULL,    merchant_uuid UUID NOT NULL,    qty_diff INT NOT NULL,    total_price_diff NUMERIC(15,2) NOT NULL,    total_cost_diff NUMERIC(15,2) NOT NULL,    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );        -- 添加註解    COMMENT ON TABLE order_modify IS '訂單修改歷史表，記錄訂單數量或價格變更的歷史記錄';    COMMENT ON COLUMN order_modify.order_modify_id IS '訂單變更 PK';    COMMENT ON COLUMN order_modify.order_uuid IS '關聯的訂單 UUID';    COMMENT ON COLUMN order_modify.client_user_uuid IS '發起變更的使用者 UUID';    COMMENT ON COLUMN order_modify.merchant_uuid IS '關聯的商家 UUID';    COMMENT ON COLUMN order_modify.qty_diff IS '數量變更差異 (可以是正負數)';    COMMENT ON COLUMN order_modify.total_price_diff IS '價格變更差異 (可以是正負數)';    COMMENT ON COLUMN order_modify.total_cost_diff IS '成本變更差異 (可以是正負數)';    COMMENT ON COLUMN order_modify.modify_dt IS '最後修改時間，提供 Hibernate 樂觀鎖機制';    COMMENT ON COLUMN order_modify.created_at IS '變更記錄創建時間';            CREATE TABLE daily_sale_check (    daily_sale_check_id SERIAL PRIMARY KEY, -- 唯一識別碼    check_date DATE NOT NULL, -- 計算的日期    merchant_uuid UUID NOT NULL, -- 商家 UUID    account_balance NUMERIC NOT NULL, -- 商家帳戶餘額    total_cost_diff NUMERIC NOT NULL, -- 前一天的 order_modify 總成本變動金額    modify_dt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    );            -- 添加註解    COMMENT ON TABLE daily_sale_check IS '每日商家銷售檢核表';    COMMENT ON COLUMN daily_sale_check.daily_sale_check_id IS '每日商家銷售檢核表 PK';    COMMENT ON COLUMN daily_sale_check.check_date IS '檢核日';    COMMENT ON COLUMN daily_sale_check.merchant_uuid IS '商家 UUID';    COMMENT ON COLUMN daily_sale_check.account_balance IS '當天accountBalance';    COMMENT ON COLUMN daily_sale_check.total_cost_diff IS '當天金額差異';